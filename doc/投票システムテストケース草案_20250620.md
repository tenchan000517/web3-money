# WEB3 MONEY投票システム テストケース草案

**作成日**: 2025年6月20日  
**対象システム**: WEB3 MONEY投票システム  
**作成者**: Claude Code  
**ステータス**: 草案（レビュー待ち）

## 📋 テストケース概要

**合計テストケース数**: 39個  
**重要度分類**:
- 🔴 **最優先**: 11個（投票機能・重み付け・セキュリティ）
- 🟡 **中優先**: 16個（アクセス制御・統合テスト）  
- 🟢 **低優先**: 12個（UI/UX・パフォーマンス）

---

## **A. アクセス制御テスト** 🟡

### A1. リファラーチェックテスト
- **A1-1** 正規ドメイン(`xmobile.ne.jp/customer/`)からのアクセス → 成功
- **A1-2** 不正ドメインからの直接アクセス → 拒否
- **A1-3** リファラーなしの直接URL入力 → 拒否
- **A1-4** 開発モード(`IS_DEVELOPMENT_STAGE=true`)での直接アクセス → 成功

### A2. セッション管理テスト  
- **A2-1** `/relay-basic` → `/main-basic` 正常遷移
- **A2-2** `/relay-premium` → `/main-premium` 正常遷移  
- **A2-3** セッションなしで`/main-*`直接アクセス → 拒否
- **A2-4** 異なる契約タイプのページ間遷移 → 拒否

---

## **B. 投票機能テスト** 🔴

### B1. 認証フォームテスト
- **B1-1** 全項目入力での投票 → 成功
- **B1-2** フィナンシェID未入力 → エラー表示
- **B1-3** メールアドレス未入力 → エラー表示  
- **B1-4** 無効なメール形式 → エラー表示
- **B1-5** お名前未入力 → エラー表示

### B2. 投票処理テスト
- **B2-1** 基本ページでの初回投票 → 成功（重み1適用）
- **B2-2** プレミアムページでの初回投票 → 成功（重み5適用）
- **B2-3** YouTube出演選択（プレミアムのみ） → 成功
- **B2-4** YouTube出演選択（基本ページ） → オプション非表示

### B3. 重複制御テスト
- **B3-1** 同一メール・同一申請者・同一ページでの重複投票 → 拒否
- **B3-2** 同一メール・異なる申請者への投票 → 成功
- **B3-3** 同一メール・基本/プレミアム両ページでの投票 → 成功（最大2回）
- **B3-4** 異なるメール・同一申請者への投票 → 成功

---

## **C. 重み付けシステムテスト** 🔴

### C1. 重み適用テスト
- **C1-1** 基本ページ投票での重み1適用確認（バックエンドのみ）
- **C1-2** プレミアムページ投票での重み5適用確認（バックエンドのみ）
- **C1-3** 管理者キーでの重み付きデータ取得 → 成功
- **C1-4** 一般ユーザーの重み情報取得試行 → 拒否

### C2. 情報漏洩防止テスト
- **C2-1** フロントエンドでの重み情報表示確認 → 非表示
- **C2-2** ブラウザDevToolsでの重み情報検索 → 検出されない
- **C2-3** APIレスポンスでの重み情報確認 → 非表示
- **C2-4** 投票後の「強化投票権」等の表示確認 → 非表示

---

## **D. セキュリティテスト** 🔴

### D1. プライベートデータ保護テスト
- **D1-1** プライベート投票スプレッドシートの直接アクセス → 拒否
- **D1-2** プライベート投票GASの直接呼び出し → 拒否  
- **D1-3** 管理者キーなしでの投票データ取得 → 拒否
- **D1-4** IPアドレスハッシュ化確認 → 実装確認

### D2. 投票ページ選択防止テスト
- **D2-1** VotingPageSelectorコンポーネント存在確認 → 削除済み
- **D2-2** ユーザーによる投票ページ選択UI → 非存在
- **D2-3** 契約タイプ自動判別機能 → 正常動作

---

## **E. UI/UXテスト** 🟢

### E1. 表示機能テスト
- **E1-1** 申請者リスト表示 → 正常
- **E1-2** ランキング表示（1-3位アイコン） → 正常
- **E1-3** 同順位処理 → 正常
- **E1-4** アコーディオンUI（詳細展開） → 正常
- **E1-5** レスポンシブ対応（モバイル/デスクトップ） → 正常

### E2. エラーハンドリングテスト
- **E2-1** API通信エラー時の表示 → ユーザーフレンドリー
- **E2-2** データ取得失敗時の再試行ボタン → 正常
- **E2-3** 投票失敗時のエラーメッセージ → 明確
- **E2-4** 重複投票時の警告表示 → 適切

---

## **F. 統合テスト** 🟡

### F1. エンドツーエンドテスト
- **F1-1** 完全な投票フロー（基本契約者） → 全工程成功
- **F1-2** 完全な投票フロー（プレミアム契約者） → 全工程成功
- **F1-3** 同一ユーザーの両ページ投票 → 成功（最大2回）
- **F1-4** 複数ユーザーの同時投票 → 競合なし

### F2. データ同期テスト
- **F2-1** 投票後のランキング即座更新 → 成功
- **F2-2** プライベートGASとの連携 → 正常
- **F2-3** 読み取り専用GASとの連携 → 正常
- **F2-4** スプレッドシートとの同期 → 正常

---

## **G. パフォーマンステスト** 🟢

### G1. 負荷テスト
- **G1-1** 同時アクセス数テスト（10ユーザー）
- **G1-2** 同時投票処理テスト（5ユーザー）
- **G1-3** データ取得レスポンス時間測定
- **G1-4** API通信タイムアウト設定確認

---

## 📊 実行優先度ガイドライン

### 最優先実行（🔴）
システムの核心機能とセキュリティに関するテスト
- **投票機能**: B1-1〜B3-4（9個）
- **重み付けシステム**: C1-1〜C2-4（8個） 
- **セキュリティ**: D1-1〜D2-3（7個）

### 中優先実行（🟡）
システムの正常性確認に関するテスト
- **アクセス制御**: A1-1〜A2-4（8個）
- **統合テスト**: F1-1〜F2-4（8個）

### 低優先実行（🟢）
ユーザビリティとパフォーマンスに関するテスト
- **UI/UX**: E1-1〜E2-4（9個）
- **パフォーマンス**: G1-1〜G1-4（4個）

---

## 🔧 テスト実行環境

**本番URL**: https://web3-money-pd2hfv2z8-tenchan000517s-projects.vercel.app

**テスト用設定**:
- 開発モード: `IS_DEVELOPMENT_STAGE = true` (リファラーチェック無効化)
- Google Apps Script API: デプロイ済み
- プライベート投票システム: 実装完了

**必要な事前準備**:
1. テスト用メールアドレスの準備（複数）
2. 管理者キーの確認
3. テスト投票後のデータ確認方法の確立

---

## ✅ 実行チェックリスト

各テストケース実行時のチェック項目：

- [ ] **実行前**: テスト環境の確認
- [ ] **実行中**: 実際の動作と期待値の照合
- [ ] **実行後**: データの整合性確認
- [ ] **記録**: 実行結果と問題点の記録
- [ ] **修正**: 発見された問題の修正対応

---

**レビュー完了後、実行するテストケースを確定し、テスト実行計画書に移行する予定**