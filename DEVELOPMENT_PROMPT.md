# WEB3 MONEY 開発継続プロンプト

## 🚨 緊急実装中：プライバシー保護アーキテクチャ再設計

### 現在の状況
**重大な情報漏洩リスク**を発見し、アーキテクチャの全面見直しを実施中です。現在はシミュレーションテスト段階で、テスト完了後に実装開始予定です。

---

## 📋 開発エンジニア向けプロンプト

```
あなたはWEB3 MONEYシステムの開発エンジニアです。現在、プライバシー保護を重視した新アーキテクチャの実装を担当しています。

【現在のタスク】
シミュレーションテスト環境の構築と検証を実施中です。以下のドキュメントを必ず確認してください：

1. `/mnt/c/web3-money/doc/実装計画書_20250620.md` - 全体実装計画
2. `/mnt/c/web3-money/doc/シミュレーションテスト計画書_20250620.md` - 現在実行中のテスト計画
3. `/mnt/c/web3-money/ISSUES.md` - 発見された問題点
4. `/mnt/c/web3-money/doc/要望書_20250620.md` - FUJITA様からの要望

【重要な制約事項】
- 投票ポイント/重み情報を絶対にUIに表示しない
- ユーザーが投票ページを選択できないようにする
- 契約者情報は持っていないため、リファラーのみで判別
- プライベートスプレッドシート（専用GAS）でデータ管理

【現在の進行状況】
Phase: シミュレーションテスト環境構築中
Next: テスト実行→実装開始のフロー

作業を継続してください。
```

---

## 🔧 開発ルール

### 絶対遵守事項
1. **情報漏洩防止**
   - 投票ポイント・重み・「強化投票権」等の表記を一切UIに表示しない
   - VotingPageSelectorコンポーネントは即座に削除
   - バックエンドでのみ重み計算を行う

2. **アクセス制御**
   - ユーザーに投票ページを選択させない
   - リファラーチェックのみで契約レベルを判別
   - 直接URL アクセスは全て拒否

3. **データプライバシー**
   - スプレッドシートを非共有設定
   - 専用Google Apps Scriptでアクセス
   - メールアドレスベースの投票管理

### アーキテクチャ設計
```
レリモバサイト（同一ドメイン）
├── リンクA → /relay-basic → /main-basic （白背景）
└── リンクB → /relay-premium → /main-premium （黒背景）

投票システム:
- 両ページで同一コンテンツ表示
- 各ページから1回ずつ投票可能（最大2回/ユーザー）
- 重み（basic:1, premium:5）は完全非表示
- メールアドレスで重複制御
```

### 必須テスト項目
1. リファラーチェック動作確認
2. ページ間アクセス制御
3. 投票機能とポイント反映
4. 重複投票防止
5. 接続安定性

### 実装フロー
```
現在 → シミュレーションテスト → テスト成功 → 実装開始
     ↓
   テスト失敗 → アーキテクチャ修正 → 再テスト
```

### ファイル構成（予定）
```
src/app/
├── relay-basic/page.tsx     # 基本契約者認証
├── relay-premium/page.tsx   # プレミアム契約者認証  
├── main-basic/page.tsx      # 基本契約者メイン
└── main-premium/page.tsx    # プレミアム契約者メイン

削除対象:
├── components/VotingPageSelector.tsx # 即座に削除
└── 投票ポイント関連の全UI表記
```

### Git管理
- ブランチ: `claude/issue-2-20250605_063254`
- 重要な変更は必ずコミット
- コミットメッセージに進捗状況を記載

### 緊急連絡事項
- **VotingPageSelector.tsx** に「1票あたり+1ポイント」「1票あたり+5ポイント」の記載有り
- この情報漏洩により現在のシステムは使用不可状態
- 新アーキテクチャでの完全作り直しが必要

---

## 📞 次のエンジニアへの引き継ぎ

このファイルを読んだら、以下を実行してください：

1. **状況確認**
```bash
cd /mnt/c/web3-money
git status
git log --oneline -5
```

2. **ドキュメント確認**
```bash
ls doc/
cat doc/シミュレーションテスト計画書_20250620.md
```

3. **現在のタスク確認**
```bash
# TodoReadツールで現在のタスクリストを確認
```

4. **作業継続**
- シミュレーションテスト環境の構築
- テスト実行と結果検証
- テスト成功後の実装開始

### 重要な判断基準
- ✅ **全テストクリア** → 実装開始
- ❌ **テスト失敗** → アーキテクチャ見直し
- ⚠️ **設計不明点** → FUJITA様要望書と実装計画書を再確認

---

**このプロンプトにより、いつでも正確な状況把握と作業継続が可能です。**