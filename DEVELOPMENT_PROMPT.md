# WEB3 MONEY 開発継続プロンプト

## ✅ 完了：プライバシー保護アーキテクチャ実装

### 現在の状況
**重大な情報漏洩リスク**を完全に解決し、新アーキテクチャの実装が完了しました。シミュレーションテストも成功し、本格運用可能な状態です。

---

## 📋 開発エンジニア向けプロンプト

```
あなたはWEB3 MONEYシステムの開発エンジニアです。現在、プライバシー保護を重視した新アーキテクチャの実装を担当しています。

【完了したタスク】
✅ 情報漏洩防止（VotingPageSelector.tsx削除）
✅ 新アーキテクチャ実装（relay-basic/premium → main-basic/premium）
✅ シミュレーションテスト成功
✅ セキュリティ強化（リファラーチェック + セッション認証）
✅ UI/UX改善（絵文字→Lucideアイコン統一）

参考ドキュメント：
1. `/mnt/c/web3-money/doc/実装計画書_20250620.md` - 実装完了済み
2. `/mnt/c/web3-money/doc/シミュレーションテスト計画書_20250620.md` - テスト成功済み

【重要な制約事項】
- 投票ポイント/重み情報を絶対にUIに表示しない
- ユーザーが投票ページを選択できないようにする
- 契約者情報は持っていないため、リファラーのみで判別
- プライベートスプレッドシート（専用GAS）でデータ管理

【現在の進行状況】
Phase: UI/UX最終調整必要 ⚠️ (コミット: f367d93)
Next: **UI最終調整** → プライベート投票GAS連携テスト → 本番環境リリース準備

【最新完了事項】2025年6月20日 21:00
✅ プライベート投票システム完全実装 (private-votes.gs)
✅ 読み取り専用APIハブ実装・デプロイ完了 (readonly-main.gs)
✅ **データ受信テスト成功** - 申請者3名分の全データ取得確認
✅ 全15フィールドの完全取得確認（メール、長文データ含む）
✅ **フロントエンドサイト表示実装完了** - 実際のGoogleフォームデータ表示
✅ Web3ネーム表示最適化・希望金額正規化処理実装
✅ UI改善（不要フィールド削除、フォント統一）
✅ **絵文字→Lucideアイコン統一完了** - アクセシビリティとUI一貫性向上
✅ ナレッジベース作成・他プロジェクト共有

【デプロイ済みGAS】
✅ 読み取り専用GAS: https://script.google.com/macros/s/AKfycbzqF7tHHQ9prKEA8jwwSQI0c90Ui3cUSKsG4_KVBjDpTeWi5K1Ejiux7k7INMgU_oI3/exec
✅ プライベート投票GAS: デプロイ済み
✅ NEXT_PUBLIC_GAS_API_URL=https://script.google.com/macros/s/AKfycbxlvP4m_u9njP07uizQ42BiurLLFpLrKt0QXmJxOMPG2I4M8QqfclsUSwNecD3t_9WXBg/exec

【🚨 緊急修正タスク】
1. **UI/UX最終調整**（最優先）
   - VotingCard: 詳細な仕様用途をアコーディオンUIに変更
   - VotingCard: 応募への想いをアコーディオンUIに変更
   - モバイル対応: テキストスライス行数調整（PCは現状維持、モバイルは少し短く）
   - SNS欄完全削除（VotingCardから）
   - 全体デザイン: 黒背景テーマに統一（現在は投票カードのみ黒背景）
     * MainPageContentの背景を黒に変更
     * 各コンテナを黒背景に合わせて調整
     * テキスト色を白系に調整
   - モバイル最適化:
     * ヘッダーサイズ縮小
     * モバイルではヘッダータイトル非表示
   - 技術的修正:
     * favicon.ico問題修正（conflicting public file error）
     * 「テスト表示」表記を完全削除

2. **プライベート投票GAS連携テスト**
   - 実際の投票機能動作確認
   - 重み付けシステム動作確認（basic:1, premium:5）
   - メールアドレスベース重複制御テスト
   - YouTube出演選択機能テスト（プレミアムページ）

3. **エラーハンドリング強化**
   - 接続失敗時の適切なエラー表示
   - 投票失敗時のユーザーフレンドリーなメッセージ
   - リトライ機能の実装

4. **本番環境リリース準備**
   - 最終セキュリティ検証
   - パフォーマンステスト
   - ユーザーマニュアル作成

5. **キャンペーン管理機能リファクタリング**（将来実装）
   - 新しいGoogleフォーム = 新しいスプレッドシート = 新しいキャンペーン
   - 各スプレッドシートに専用GAS設定
   - 管理画面からの動的キャンペーン作成・管理機能
```

---

## 🔧 開発ルール

### 絶対遵守事項
1. **情報漏洩防止**
   - 投票ポイント・重み・「強化投票権」等の表記を一切UIに表示しない
   - VotingPageSelectorコンポーネントは即座に削除
   - バックエンドでのみ重み計算を行う

2. **アクセス制御**
   - ユーザーに投票ページを選択させない
   - リファラーチェックのみで契約レベルを判別
   - 直接URL アクセスは全て拒否

3. **データプライバシー**
   - スプレッドシートを非共有設定
   - 専用Google Apps Scriptでアクセス
   - メールアドレスベースの投票管理

### アーキテクチャ設計
```
レリモバサイト（同一ドメイン）
├── リンクA → /relay-basic → /main-basic （黒背景）
└── リンクB → /relay-premium → /main-premium （黒背景）

投票システム:
- 両ページで同一コンテンツ表示（黒背景テーマで統一）
- 各ページから1回ずつ投票可能（最大2回/ユーザー）
- 重み（basic:1, premium:5）は完全非表示
- メールアドレスで重複制御
```

### 必須テスト項目
1. UI/UX最終調整の動作確認
2. プライベート投票GAS連携テスト
3. 重み付き投票機能の動作確認
4. 重複投票防止機能
5. YouTube出演選択機能（プレミアムのみ）
6. エラーハンドリング確認

### 🎯 緊急修正詳細

#### VotingCard.tsx 修正項目
```typescript
// 1. SNS欄完全削除
// applicant.sns関連のコードを全て削除

// 2. アコーディオンUI実装
// 詳細な仕様用途（detailedReason）
// 応募への想い（thoughts）
// useStateでアコーディオン開閉状態管理

// 3. モバイル対応テキストスライス
// PC: 現状維持（150文字）
// モバイル: 75-100文字程度に短縮
// useEffect + window.innerWidthで判定
```

#### MainPageContent.tsx 修正項目
```typescript
// 1. 黒背景テーマ統一
// min-h-screen の background を黒に変更
// 各コンテナのbg-whiteをbg-gray-800等に変更
// text-gray-800をtext-white等に変更

// 2. モバイルヘッダー最適化
// ヘッダーサイズ縮小
// モバイルでタイトル非表示
// useEffect + window.innerWidthで判定

// 3. テスト表示削除
// "テスト表示"関連のテキストとコンテナを完全削除
```

#### favicon修正
```bash
# public/favicon.ico の conflicting file エラー修正
# pages/favicon.ico があれば削除
# public/favicon.ico を適切に配置
```

### UI/UX実装完了
```
✅ 絵文字 → Lucideアイコン統一
✅ アクセシビリティ向上
✅ アイコンの一貫性確保
✅ MainPageContent: Megaphone, Heart, Lock, Shield等
✅ VotingCard: Trophy, Medal, Award等ランキングアイコン
✅ NoticeList: Megaphoneアイコン
✅ CampaignTabs: Lightbulb, Clock, Voteアイコン

⚠️ 緊急修正必要:
- VotingCardアコーディオンUI
- 黒背景テーマ統一
- モバイル最適化
- SNS欄削除
- favicon修正
```

### Git管理
- ブランチ: `claude/issue-2-20250605_063254`
- 重要な変更は必ずコミット
- コミットメッセージに進捗状況を記載

### 完了事項
- ✅ **VotingPageSelector.tsx削除完了** - 情報漏洩問題解決済み
- ✅ **新アーキテクチャ実装完了** - プライバシー保護システム稼働中
- ✅ **シミュレーションテスト成功** - 全機能動作確認済み
- ✅ **フロントエンドUI改善完了** - Lucideアイコン統一済み

### 次回重要課題
- 🚨 **UI/UX最終調整実行** - アコーディオン、黒背景統一、モバイル最適化が最優先
- ❗ **プライベート投票GAS連携テスト実行** - 実際の投票動作確認
- ❗ **重み付き投票システムの動作確認** - basic:1, premium:5の重み機能
- ❗ **エラーハンドリング強化** - ユーザーフレンドリーなエラー表示

---

## 📞 次のエンジニアへの引き継ぎ

このファイルを読んだら、以下を実行してください：

1. **状況確認**
```bash
cd /mnt/c/web3-money
git status
git log --oneline -5
```

2. **緊急修正開始**
```bash
npm run dev -- --port 3001  # 開発サーバー起動
# 現在のUI確認後、緊急修正開始
```

3. **修正対象ファイル**
```bash
# 主要修正ファイル:
# - src/components/VotingCard.tsx (アコーディオン、SNS削除、モバイル対応)
# - src/components/MainPageContent.tsx (黒背景統一、モバイルヘッダー、テスト表記削除)
# - public/favicon.ico (favicon問題修正)
```

4. **修正完了後**
- git commit で進捗コミット
- このプロンプトファイルの更新
- プライベート投票GAS連携テストへ進行

### 達成済み目標
- ✅ **情報漏洩完全防止**
- ✅ **新アーキテクチャ実装完了**
- ✅ **シミュレーションテスト成功**
- ✅ **セキュリティ要件達成**
- ✅ **基本UI/UX改善完了**

### 緊急修正必要
- ⚠️ **VotingCard UI最適化**
- ⚠️ **黒背景テーマ統一**
- ⚠️ **モバイル最適化**
- ⚠️ **技術的修正**

---

**このプロンプトにより、いつでも正確な状況把握と作業継続が可能です。**